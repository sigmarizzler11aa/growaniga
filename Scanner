local Scanner = {}

function Scanner.scan(mode, resultsFrame, createResultItem)
    -- Clear existing results
    for _, child in pairs(resultsFrame:GetChildren()) do
        if child:IsA("Frame") then
            child:Destroy()
        end
    end
    
    local workspace = game:GetService("Workspace")
    local foundItems = {}
    
    -- Function to check if a model matches the search criteria
    local function checkModel(model)
        if not model:IsA("Model") then return false end
        
        -- Check for StringValue with matching name
        local stringValue = model:FindFirstChild("StringValue")
        if not stringValue then return false end
        
        if mode == "Gold" and stringValue.Value == "Gold" then
            return true
        elseif mode == "Rainbow" and stringValue.Value == "Rainbow" then
            return true
        elseif mode == "Pollinated" and stringValue.Value == "Pollinated" then
            return true
        end
        
        return false
    end
    
    -- Scan workspace for items
    local function scanWorkspace(parent)
        for _, item in pairs(parent:GetChildren()) do
            if item:IsA("Model") then
                if checkModel(item) then
                    table.insert(foundItems, item)
                end
            end
            scanWorkspace(item)
        end
    end
    
    -- Perform the scan
    scanWorkspace(workspace)
    
    -- Create result items
    for i, item in ipairs(foundItems) do
        createResultItem(item, i)
    end
end

function Scanner.advancedScan(searchName, minWeight, resultsFrame, createResultItem)
    -- Clear existing results
    for _, child in pairs(resultsFrame:GetChildren()) do
        if child:IsA("Frame") then
            child:Destroy()
        end
    end
    
    local workspace = game:GetService("Workspace")
    local foundItems = {}
    
    -- Function to check if a model matches advanced search criteria
    local function checkAdvancedSearch(model)
        if not model:IsA("Model") then return false end
        if model.Name ~= searchName then return false end
        
        local weightValue = model:FindFirstChild("Weight")
        if not weightValue or not weightValue:IsA("NumberValue") then return false end
        
        return weightValue.Value >= minWeight
    end
    
    -- Scan workspace for advanced search
    local function scanWorkspaceAdvanced(parent)
        for _, item in pairs(parent:GetChildren()) do
            if item:IsA("Model") then
                if checkAdvancedSearch(item) then
                    table.insert(foundItems, item)
                end
            end
            scanWorkspaceAdvanced(item)
        end
    end
    
    -- Perform the advanced scan
    scanWorkspaceAdvanced(workspace)
    
    -- Create result items
    for i, item in ipairs(foundItems) do
        createResultItem(item, i)
    end
end

return Scanner
